sudo: required

services:
  - docker

before_install:
  - sudo service mysql stop

install:
  - docker-compose up --build -d
  # dummy way to ensure all services ready
  - sleep 30s
  - docker-compose exec app php artisan migrate --seed

script:
  - docker-compose exec app vendor/bin/phpunit

  - > # run extensive load testing during nightly builds
      if [ "$TRAVIS_EVENT_TYPE" == "cron" ]; then
          docker run --net=host -ii loadimpact/k6 run - <load_test.js
      fi
